# 魔法门678游戏算法

主要针对魔法门6，一般也适用于魔法门7、8和整合版。

## 属性

### 七属性

下文中`修正值(某某属性)`指的是对于某某属性（七项属性之一），查询“属性修正值表格”，找到这个属性值所对应的修正值。

| 属性                | 修正值添加到？之中     | 对修正值的注释     |
|--------------------|-----------------------|--------------|
| 力量                | 近战（肉搏）攻击杀伤力 | 最小为0       |
| 精确（又译命中率） | 肉搏和射击的攻击点数   |               |
| 速度                | 防御等级             | 最小为0        |
| 速度                | 攻击恢复时间         | 减去修正值，单位为秒（即BTU） |
| 运气                | 不为0的抗性          | 将会加到不为0的抗性中，不过并不显示在角色属性栏里 |
| 耐力                | 受击恢复时间         | 20 - 修正值。所以耐力在350或以上时遭受攻击后角色能立即恢复行动 |
| 耐力                | 生命值               | 见下           |
| 个性/智力           | 魔法值               | 见下           |

### 生命值和魔法值

生命值即HP；魔法值即SP

```
增加的HP = HP修正系数 × 修正值(耐力)
```

```
增加的SP = SP修正系数 × 修正值(个性 或 智力)
```

总计算公式为（不计算直接加HP或SP的物品词缀等）：

```
HP = 基础HP + HP修正系数 × (等级 + 修正值(耐力) + 健身术技能点（专家×2，大师×3）)
```

```
SP = 基础SP + SP修正系数 × (等级 + 修正值(个性) + 修正值(智力)（注：个性与智力是否修正SP与职业有关） + 冥想术技能点（专家×2，大师×3）)
```

例如：某魔法师，23级，冥想术6级专家，智力41，那么其魔法值为（不计算直接加HP或SP的物品词缀等）：

```
SP = 魔法师基础SP + 魔法师SP修正系数 × (级别 + 修正值(智力) + 冥想术技能点 × 2（专家）)
= 10 + 4 × (23 + 8 + 6 × 2)
= 182
```

魔法门6中的职业基础HP、SP及其修正系数一览表：

|               | 基础HP | HP修正系数 | 基础SP | SP修正系数 |
|---------------|------|--------|------|--------|
| 剑客（骑士）   | 30   | 4      | 0    | 0      |
| 豪侠          | 30   | 6      | 0    | 0      |
| 勇士          | 30   | 8      | 0    | 0      |
| 牧师          | 20   | 2      | 10   | 3      |
| 神父          | 20   | 3      | 10   | 4      |
| 大主教        | 20   | 4      | 10   | 5      |
| 巫师          | 20   | 2      | 10   | 3      |
| 魔法师        | 20   | 3      | 10   | 4      |
| 大魔法师      | 20   | 4      | 10   | 5      |
| 游侠（圣武士） | 25   | 3      | 5    | 1      |
| 十字军        | 25   | 4      | 5    | 2      |
| 大英雄        | 25   | 5      | 5    | 3      |
| 弓箭手        | 25   | 3      | 5    | 1      |
| 魔箭手        | 25   | 4      | 5    | 2      |
| 神箭手        | 25   | 5      | 5    | 3      |
| 僧侣（德鲁伊） | 20   | 2      | 10   | 3      |
| 祭司          | 20   | 3      | 10   | 4      |
| 大祭司        | 20   | 4      | 10   | 5      |

魔法门6中，牧师、游侠及其升级职业靠个性奖励SP；巫师、弓箭手及其升级职业靠智力奖励SP；僧侣及其升级职业靠个性和智力同时奖励SP

### 属性修正值表格

属性修正，也称突破点、突破奖励点、奖励值、奖励修正、加权等，英文中通常使用“breakpoint”。

| 属性数值 | 修正值 |
|-----|----|
| 500 | 30 |
| 400 | 25 |
| 350 | 20 |
| 300 | 19 |
| 275 | 18 |
| 250 | 17 |
| 225 | 16 |
| 200 | 15 |
| 175 | 14 |
| 150 | 13 |
| 125 | 12 |
| 100 | 11 |
| 75  | 10 |
| 50  | 9  |
| 40  | 8  |
| 35  | 7  |
| 30  | 6  |
| 25  | 5  |
| 21  | 4  |
| 19  | 3  |
| 17  | 2  |
| 15  | 1  |
| 13  | 0  |
| 11  | -1 |
| 9   | -2 |
| 7   | -3 |
| 5   | -4 |
| 3   | -5 |
| 0   | -6 |

## 级别

升级经验公式如下：

```
角色从n级升级到第n+1级所需要增加的经验值 = n × 1000
```

```
角色升级到第n+1级所需要的总经验值 = n × (n + 1) × 500
```

## 攻击

### 杀伤力（XDY）

武器物品的杀伤力显示为XDY，意思是，攻击时，掷一个Y面的骰子，掷X次，计算掷出的点数的总和，即为对敌人的杀伤。显然最少能掷出X点，最多X × Y点（如4D5就是掷一个5面的骰子，掷4次，计算掷出的点数的总和，显然最少4点，最多4*5=20点）

杀伤力在角色属性界面中显示为多少到多少的区间，如持一把4D5的武器，不考虑其他因素，就是“4 - 20”。

### 近战攻击

近战类武器，包括榴弹枪

#### 攻击点数

攻击点数：attack bonus。角色属性界面上简称为“攻击”（attack），右键看介绍时可以看到叫做“攻击点数”。

```
攻击点数 = 修正值(精确) + 武器的攻击点数 + (武器的技能等级（之后乘以的系数仅对于榴弹枪专家和大师） × 2或3)
```

如果双持：

```
攻击点数 = 修正值(精确) + 右手武器的攻击点数 + 左手武器的攻击点数 + 左手武器的技能等级（MM7、8这里则为右手武器的技能等级）
```

#### 攻击杀伤力

攻击杀伤力：attack damage。又译“攻击破坏力”。

```
攻击杀伤力 = 修正值(力量) + 武器的杀伤力 + （仅对于该武器为专家级锤棍或大师级战斧/长矛者）武器的技能等级
```

如果双持：

```
攻击杀伤力 = 修正值(力量) + 右手武器的杀伤力 + 左手武器的杀伤力 + （之后的技能等级加成仅对于该武器为专家级锤棍或大师级战斧/长矛者）右手武器的技能等级
```

### 远程攻击

远程类武器，即弓箭和榴弹枪

#### 射击点数

射击点数：shoot bonus。角色属性界面上简称为“射击”（shoot），右键看介绍时可以看到叫做“射击点数”。

```
射击点数 = 修正值(精确) + 武器的攻击点数 + 武器的技能等级
```

#### 射击杀伤力

射击杀伤力：shoot damage。又译“射击破坏力”。

```
射击杀伤力 = 武器的杀伤力
```

注：榴弹枪表面上看是装备在右手上的。装备榴弹枪时，无视弓箭，射击点数/杀伤力的算法及最终数值和攻击点数/杀伤力的完全一致。

### 实际攻击

所有攻击都仅有一定的概率打中。玩家的角色对怪物发起普通物理攻击时，公式是：

```
击中概率 = (15 + 攻击点数 × 2)/(30 + 攻击点数 × 2 + 怪物的防御等级)
```

怪物用普通物理攻击角色命中的概率公式是：

```
怪物物理击中概率 = (5 + 怪物等级×2)/(10 + 怪物等级 × 2 + 人物盔甲等级)
```

怪物用对角色施加特殊状态、角色用冰电火毒魔系攻击打怪物、怪物用这些攻击来打角色的公式也都各不相同，这里不一一提及。

实际杀伤则就是前面说的掷骰的总点数，介于角色属性界面中显示出来的最小和最大值之间。

（当然别忘了有些武器的附加效果能够增加最高达18点的冰电火毒系杀伤力）

## 恢复时间

......

原版简体（相当于v1.0）、繁体（相当于v1.1）和英文官方补丁v1.2或GOG英文版（相当于v1.3）的MM6，都千万别双持（意思是双手各拿一把武器，而不是拿一把双手武器），因为系统会将恢复时间简单相加，极其缓慢。

中文完美补丁和GrayFace都修正了这个bug，正确的算法简而言之，是算两只手中恢复时间大的那个武器，或者如果相同，算右手武器。

即便在修正了这个双持恢复时间问题的版本中，右手拿榴弹枪后，一般左手不应该再持一武器，会严重拖慢榴弹枪的速度（计算慢的武器的恢复时间）。

### 恢复时间和杀伤力的总结

恢复时间和杀伤力一样重要（由于恢复时间有时比较容易降低，所以可能更重要），因为玩家应该关注的是“单位时间的杀伤”，显然：

```
单位时间的杀伤

= 单位时间的出手次数 × 击中概率 × 攻击平均杀伤

= (1/攻击恢复时间) × ((15 + 攻击点数 × 2) / (30 + 攻击点数 × 2 + 怪物的防御等级)) × 攻击杀伤力的平均数

= ( (15 + 攻击点数 × 2) × 攻击杀伤力的平均数 ) / ( (30 + 攻击点数 × 2 + 怪物的防御等级) × 攻击恢复时间 )
```
